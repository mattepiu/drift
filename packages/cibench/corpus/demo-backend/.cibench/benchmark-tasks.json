{
  "version": "2.0.0",
  "corpus": "demo-backend",
  "description": "Benchmark tasks for measuring codebase intelligence",
  "tasks": [
    {
      "id": "T1",
      "category": "pattern-detection",
      "difficulty": "easy",
      "question": "List all authentication middleware functions in this codebase.",
      "expectedAnswer": {
        "functions": ["authMiddleware", "adminMiddleware"],
        "locations": [
          {"file": "src/middleware/auth.ts", "line": 18},
          {"file": "src/middleware/auth.ts", "line": 42}
        ]
      },
      "scoringCriteria": {
        "fullCredit": "Both functions identified with correct file",
        "partialCredit": "At least one function identified",
        "noCredit": "Neither identified or wrong file"
      }
    },
    {
      "id": "T2",
      "category": "pattern-detection",
      "difficulty": "medium",
      "question": "What is the standard response format used in this API? Show an example.",
      "expectedAnswer": {
        "format": {
          "success": true,
          "data": "<payload>"
        },
        "helpers": ["sendSuccess", "sendPaginated", "sendCreated", "sendNoContent"],
        "location": "src/utils/response.ts"
      },
      "scoringCriteria": {
        "fullCredit": "Identifies { success: true, data: ... } format AND helper functions",
        "partialCredit": "Identifies format OR helpers but not both",
        "noCredit": "Cannot identify the response pattern"
      }
    },
    {
      "id": "T3",
      "category": "outlier-detection",
      "difficulty": "hard",
      "question": "Which API routes are missing authentication that should have it? List the security vulnerabilities.",
      "expectedAnswer": {
        "vulnerabilities": [
          {"file": "src/routes/legacy.ts", "route": "GET /users", "line": 17},
          {"file": "src/routes/legacy.ts", "route": "GET /users/:id", "line": 31},
          {"file": "src/routes/legacy.ts", "route": "POST /users", "line": 55},
          {"file": "src/routes/legacy.ts", "route": "DELETE /users/:id", "line": 74},
          {"file": "src/routes/admin.ts", "route": "GET /stats", "line": 34}
        ]
      },
      "scoringCriteria": {
        "fullCredit": "Identifies all 5 missing auth routes",
        "partialCredit": "Identifies 2-4 missing auth routes",
        "noCredit": "Identifies 0-1 or many false positives"
      }
    },
    {
      "id": "T4",
      "category": "outlier-detection",
      "difficulty": "medium",
      "question": "Which routes use non-standard response formats (not using sendSuccess/sendPaginated/sendCreated)?",
      "expectedAnswer": {
        "violations": [
          {"file": "src/routes/legacy.ts", "line": 25, "issue": "res.send() instead of sendSuccess()"},
          {"file": "src/routes/legacy.ts", "line": 49, "issue": "res.json() instead of sendSuccess()"},
          {"file": "src/routes/legacy.ts", "line": 69, "issue": "res.status(201).json() instead of sendCreated()"},
          {"file": "src/routes/legacy.ts", "line": 81, "issue": "res.json() with wrong format"},
          {"file": "src/routes/legacy.ts", "line": 92, "issue": "completely different response structure"},
          {"file": "src/routes/legacy.ts", "line": 108, "issue": "res.json() instead of sendCreated()"},
          {"file": "src/routes/admin.ts", "line": 44, "issue": "res.json() instead of sendSuccess()"},
          {"file": "src/routes/admin.ts", "line": 51, "issue": "res.send() instead of sendSuccess()"}
        ]
      },
      "scoringCriteria": {
        "fullCredit": "Identifies 6+ violations with correct reasoning",
        "partialCredit": "Identifies 3-5 violations",
        "noCredit": "Identifies 0-2 or cannot explain why they're violations"
      }
    },
    {
      "id": "T5",
      "category": "architectural-understanding",
      "difficulty": "medium",
      "question": "Describe the error handling architecture. What error classes exist and how are they used?",
      "expectedAnswer": {
        "hierarchy": {
          "base": "ApiError",
          "derived": ["NotFoundError", "ValidationError", "UnauthorizedError"]
        },
        "centralHandler": "src/middleware/errorHandler.ts",
        "pattern": "Errors thrown anywhere are caught by errorHandler middleware"
      },
      "scoringCriteria": {
        "fullCredit": "Identifies hierarchy, all error classes, and central handler pattern",
        "partialCredit": "Identifies error classes but misses central handler pattern",
        "noCredit": "Cannot describe error handling architecture"
      }
    },
    {
      "id": "T6",
      "category": "architectural-understanding",
      "difficulty": "hard",
      "question": "What is the layered architecture of this codebase? Describe the separation of concerns.",
      "expectedAnswer": {
        "layers": [
          {"name": "Routes", "responsibility": "HTTP handling, request/response", "location": "src/routes/"},
          {"name": "Middleware", "responsibility": "Cross-cutting concerns (auth, logging, errors)", "location": "src/middleware/"},
          {"name": "Services", "responsibility": "Business logic", "location": "src/services/"},
          {"name": "Utils", "responsibility": "Shared utilities (response helpers, error classes)", "location": "src/utils/"}
        ],
        "dataFlow": "Request → Middleware → Route → Service → Response"
      },
      "scoringCriteria": {
        "fullCredit": "Identifies all 4 layers with correct responsibilities",
        "partialCredit": "Identifies 2-3 layers correctly",
        "noCredit": "Cannot describe layered architecture"
      }
    },
    {
      "id": "T7",
      "category": "impact-analysis",
      "difficulty": "hard",
      "question": "If I change the authMiddleware function signature, which files would be affected?",
      "expectedAnswer": {
        "directlyAffected": [
          "src/routes/users.ts",
          "src/routes/products.ts",
          "src/routes/orders.ts",
          "src/routes/admin.ts",
          "src/index.ts"
        ],
        "notAffected": ["src/routes/legacy.ts"],
        "reason": "legacy.ts doesn't use authMiddleware (which is the bug)"
      },
      "scoringCriteria": {
        "fullCredit": "Lists all 5 affected files AND notes legacy.ts is not affected",
        "partialCredit": "Lists most affected files but misses the legacy.ts insight",
        "noCredit": "Cannot trace authMiddleware usage"
      }
    },
    {
      "id": "T8",
      "category": "code-generation-context",
      "difficulty": "medium",
      "question": "I want to add a new route POST /api/users/:id/avatar. What patterns should I follow? Show me an example of a similar route.",
      "expectedAnswer": {
        "patterns": [
          "Use authMiddleware for authentication",
          "Use sendSuccess() or sendCreated() for response",
          "Throw ValidationError for bad input",
          "Throw NotFoundError if user doesn't exist",
          "Use async/await with implicit error handling"
        ],
        "exampleRoute": "POST /api/users in src/routes/users.ts lines 40-49"
      },
      "scoringCriteria": {
        "fullCredit": "Lists all patterns AND provides correct example route",
        "partialCredit": "Lists some patterns OR provides example but not both",
        "noCredit": "Cannot identify patterns for new route"
      }
    }
  ],
  "scoring": {
    "fullCredit": 2,
    "partialCredit": 1,
    "noCredit": 0,
    "maxScore": 16
  }
}
