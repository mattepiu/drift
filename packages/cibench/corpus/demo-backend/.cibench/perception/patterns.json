{
  "version": "2.0.0",
  "patterns": [
    {
      "id": "auth-middleware",
      "category": "auth",
      "name": "Auth Middleware Detector",
      "description": "Express middleware that validates authentication from Authorization header",
      "locations": [
        { "file": "src/middleware/auth.ts", "line": 18, "confidence": 1.0, "variant": "jwt-bearer" }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Centralize authentication logic to ensure consistent security across all protected routes"
    },
    {
      "id": "rbac-patterns",
      "category": "auth",
      "name": "RBAC Patterns Detector",
      "description": "Middleware that checks for admin role after authentication",
      "locations": [
        { "file": "src/middleware/auth.ts", "line": 42, "confidence": 1.0, "variant": "role-check" }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Separate authorization from authentication for cleaner role-based access control"
    },
    {
      "id": "error-handler",
      "category": "errors",
      "name": "Try/Catch Detector",
      "description": "Express error middleware that catches all errors and formats consistent responses",
      "locations": [
        { "file": "src/middleware/errorHandler.ts", "line": 11, "confidence": 1.0 }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Single point of error handling ensures consistent error responses and logging"
    },
    {
      "id": "exception-hierarchy",
      "category": "errors",
      "name": "Exception Hierarchy Detector",
      "description": "Application-specific error classes extending base Error with status codes",
      "locations": [
        { "file": "src/utils/errors.ts", "line": 7, "confidence": 1.0, "variant": "base-error" },
        { "file": "src/utils/errors.ts", "line": 18, "confidence": 1.0, "variant": "not-found" },
        { "file": "src/utils/errors.ts", "line": 25, "confidence": 1.0, "variant": "validation" },
        { "file": "src/utils/errors.ts", "line": 32, "confidence": 1.0, "variant": "unauthorized" }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Type-safe error handling with semantic error types for better error categorization"
    },
    {
      "id": "route-structure",
      "category": "api",
      "name": "Route Structure Detector",
      "description": "Utility functions that ensure consistent API response format",
      "locations": [
        { "file": "src/utils/response.ts", "line": 16, "confidence": 1.0, "variant": "success" },
        { "file": "src/utils/response.ts", "line": 24, "confidence": 1.0, "variant": "paginated" },
        { "file": "src/utils/response.ts", "line": 40, "confidence": 1.0, "variant": "created" },
        { "file": "src/utils/response.ts", "line": 44, "confidence": 1.0, "variant": "no-content" }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "medium",
      "intent": "Enforce consistent API contract across all endpoints"
    },
    {
      "id": "service-layer",
      "category": "structural",
      "name": "Service Layer Pattern",
      "description": "Business logic encapsulated in service classes, separate from route handlers",
      "locations": [
        { "file": "src/services/userService.ts", "line": 24, "confidence": 1.0 },
        { "file": "src/services/productService.ts", "line": 1, "confidence": 0.9 },
        { "file": "src/services/orderService.ts", "line": 1, "confidence": 0.9 }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "medium",
      "intent": "Separation of concerns - routes handle HTTP, services handle business logic"
    },
    {
      "id": "crud-routes",
      "category": "api",
      "name": "Express Route Detector",
      "description": "Standard REST endpoints following GET/POST/PUT/DELETE conventions",
      "locations": [
        { "file": "src/routes/users.ts", "line": 19, "confidence": 1.0, "variant": "list" },
        { "file": "src/routes/users.ts", "line": 27, "confidence": 1.0, "variant": "get-by-id" },
        { "file": "src/routes/users.ts", "line": 37, "confidence": 1.0, "variant": "create" },
        { "file": "src/routes/users.ts", "line": 49, "confidence": 1.0, "variant": "update" },
        { "file": "src/routes/users.ts", "line": 59, "confidence": 1.0, "variant": "delete" },
        { "file": "src/routes/products.ts", "line": 17, "confidence": 1.0, "variant": "list" },
        { "file": "src/routes/products.ts", "line": 26, "confidence": 1.0, "variant": "get-by-id" },
        { "file": "src/routes/products.ts", "line": 36, "confidence": 1.0, "variant": "create" },
        { "file": "src/routes/products.ts", "line": 48, "confidence": 1.0, "variant": "update" },
        { "file": "src/routes/products.ts", "line": 58, "confidence": 1.0, "variant": "delete" },
        { "file": "src/routes/orders.ts", "line": 19, "confidence": 1.0, "variant": "list" },
        { "file": "src/routes/orders.ts", "line": 28, "confidence": 1.0, "variant": "get-by-id" },
        { "file": "src/routes/orders.ts", "line": 38, "confidence": 1.0, "variant": "create" }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Consistent REST API design for predictable client integration"
    },
    {
      "id": "request-logger",
      "category": "logging",
      "name": "Request Logging Detector",
      "description": "Middleware that logs all incoming requests with timing",
      "locations": [
        { "file": "src/middleware/logger.ts", "line": 9, "confidence": 1.0 }
      ],
      "groundTruthConfidence": 1.0,
      "detectionDifficulty": "easy",
      "intent": "Observability - track all API requests for debugging and monitoring"
    }
  ],
  "outliers": [
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/legacy.ts", "line": 17 },
      "reason": "Legacy route handler missing authentication middleware on protected endpoint",
      "intentional": false,
      "severity": "error"
    },
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/legacy.ts", "line": 29 },
      "reason": "GET user by ID missing authentication",
      "intentional": false,
      "severity": "error"
    },
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/legacy.ts", "line": 49 },
      "reason": "POST user missing authentication on write operation",
      "intentional": false,
      "severity": "error"
    },
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/legacy.ts", "line": 68 },
      "reason": "DELETE user missing authentication",
      "intentional": false,
      "severity": "error"
    },
    {
      "patternId": "route-structure",
      "location": { "file": "src/routes/legacy.ts", "line": 24 },
      "reason": "Using res.send() instead of sendSuccess() - inconsistent response format",
      "intentional": false,
      "severity": "warning"
    },
    {
      "patternId": "route-structure",
      "location": { "file": "src/routes/legacy.ts", "line": 44 },
      "reason": "Using res.json() instead of sendSuccess() - inconsistent response format",
      "intentional": false,
      "severity": "warning"
    },
    {
      "patternId": "route-structure",
      "location": { "file": "src/routes/legacy.ts", "line": 63 },
      "reason": "Using custom response wrapper { user: newUser } instead of standard format",
      "intentional": false,
      "severity": "warning"
    },
    {
      "patternId": "exception-hierarchy",
      "location": { "file": "src/routes/legacy.ts", "line": 34 },
      "reason": "Using inline error response instead of ValidationError",
      "intentional": false,
      "severity": "warning"
    },
    {
      "patternId": "exception-hierarchy",
      "location": { "file": "src/routes/legacy.ts", "line": 40 },
      "reason": "Using inline 404 response instead of NotFoundError",
      "intentional": false,
      "severity": "warning"
    },
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/products.ts", "line": 17 },
      "reason": "Product listing intentionally public - no auth required for browsing",
      "intentional": true,
      "severity": "info"
    },
    {
      "patternId": "auth-middleware",
      "location": { "file": "src/routes/products.ts", "line": 26 },
      "reason": "Product detail intentionally public - no auth required for viewing",
      "intentional": true,
      "severity": "info"
    }
  ],
  "relationships": [
    {
      "from": "auth-middleware",
      "to": "exception-hierarchy",
      "type": "depends-on",
      "strength": 1.0
    },
    {
      "from": "error-handler",
      "to": "exception-hierarchy",
      "type": "depends-on",
      "strength": 1.0
    },
    {
      "from": "crud-routes",
      "to": "route-structure",
      "type": "depends-on",
      "strength": 0.9
    },
    {
      "from": "crud-routes",
      "to": "service-layer",
      "type": "depends-on",
      "strength": 0.8
    },
    {
      "from": "crud-routes",
      "to": "auth-middleware",
      "type": "co-occurs",
      "strength": 0.7
    }
  ]
}
