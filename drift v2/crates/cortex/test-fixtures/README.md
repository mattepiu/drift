# Cortex Test Fixtures

Golden datasets, benchmark data, and integration test scenarios for the Cortex memory system.

## Structure

```
test-fixtures/
├── golden/                          # Expected input/output pairs for deterministic tests
│   ├── consolidation/  (10 files)   # Clustering, recall gate, summary generation, dedup
│   ├── retrieval/      (10 files)   # Keyword, semantic, hybrid, intent, budget, dedup
│   ├── contradiction/  (5 files)    # Direct, partial, temporal, consensus, propagation
│   ├── causal/         (5 files)    # Chain, branching, cycle rejection, counterfactual, narrative
│   └── privacy/        (4 files)    # PII, secrets, false positives, idempotency
├── benchmarks/                      # Scaled datasets for performance benchmarks
│   ├── memories_100.json            # 100 memories (small-scale)
│   ├── memories_1k.json             # 1K memories (medium-scale)
│   ├── memories_10k.json            # 10K memories (large-scale)
│   ├── embeddings_1024dim.bin       # Pre-computed 1024-dim embeddings (100 vectors)
│   ├── queries_50.json              # 50 benchmark queries with expected result types
│   └── causal_graph_1k_edges.json   # 1K-edge causal graph for traversal benchmarks
└── integration/                     # End-to-end integration test scenarios
    ├── full_lifecycle.json           # create → consolidate → retrieve → decay → validate
    ├── concurrent_access.json        # 10 parallel reads + 1 write
    ├── embedding_migration.json      # Model swap mid-operation with FTS5 fallback
    └── degradation_scenarios.json    # 10 component failures + expected fallbacks
```

## Golden Dataset Format

Each golden dataset JSON file follows this structure:

```json
{
  "description": "Human-readable description of the test scenario",
  "input": { ... },
  "expected_output": { ... }
}
```

- `input`: The data to feed into the system under test
- `expected_output`: Assertions about what the system should produce

## Adding New Fixtures

1. Create a JSON file in the appropriate `golden/` subdirectory
2. Include `description`, `input`, and `expected_output` fields
3. Use real Cortex data shapes (BaseMemory, TypedContent, etc.)
4. Reference the fixture from the corresponding crate's test file
5. Run `python3 -m json.tool <file>` to validate JSON syntax

## Benchmark Data

Benchmark memories are generated by `benchmarks/gen_benchmarks.py`. To regenerate:

```bash
cd test-fixtures/benchmarks
python3 gen_benchmarks.py
```

The `embeddings_1024dim.bin` file is a binary format:
- Header: `count: u32 (LE)`, `dims: u32 (LE)`
- Body: `count * dims * f32 (LE)` — normalized vectors

## Performance Targets (T14-INT-11)

| Operation | Target |
|-----------|--------|
| Retrieval (100 memories) | < 5ms p95 |
| Retrieval (10K memories) | < 50ms p95 |
| Consolidation (cluster of 5) | < 10ms |
| Embedding (single) | < 100ms |
| Decay (1K memories) | < 1ms |
| Causal traversal (depth 5, 1K edges) | < 5ms |
