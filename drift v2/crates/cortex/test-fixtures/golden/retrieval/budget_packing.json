{
  "description": "Bin-packing should respect token budget — never exceed, maximize utilization",
  "input": {
    "stored_memories": [
      {
        "id": "mem-r60",
        "memory_type": "semantic",
        "content": { "type": "semantic", "data": { "knowledge": "The retrieval pipeline has two stages: candidate gathering (FTS5 + vector + entity expansion → RRF fusion) and re-ranking (8-factor scorer → optional cross-encoder → dedup → compress). This ensures both keyword and semantic matches are considered.", "source_episodes": ["ep-600"], "consolidation_confidence": 0.90 } },
        "summary": "2-stage retrieval: candidate gathering with RRF, then 8-factor re-ranking",
        "confidence": 0.90, "importance": "high",
        "tags": ["retrieval", "architecture"],
        "content_hash": "hash_r60"
      },
      {
        "id": "mem-r61",
        "memory_type": "tribal",
        "content": { "type": "tribal", "data": { "knowledge": "Always set a token budget for retrieval. Without a budget, the context window fills up and the LLM loses focus. Default budget is 2000 tokens.", "severity": "high", "warnings": ["Context window overflow"], "consequences": ["LLM response quality degrades"] } },
        "summary": "Always set retrieval token budget — default 2000 tokens",
        "confidence": 0.92, "importance": "high",
        "tags": ["retrieval", "budget"],
        "content_hash": "hash_r61"
      },
      {
        "id": "mem-r62",
        "memory_type": "semantic",
        "content": { "type": "semantic", "data": { "knowledge": "Compression levels: L0 = IDs only (~5 tokens), L1 = summary (~20 tokens), L2 = key facts (~100 tokens), L3 = full context (~500 tokens). Budget packing tries L3 first, falls back to lower levels.", "source_episodes": ["ep-602"], "consolidation_confidence": 0.87 } },
        "summary": "4 compression levels: L0 IDs, L1 summary, L2 key facts, L3 full context",
        "confidence": 0.87, "importance": "normal",
        "tags": ["compression", "retrieval"],
        "content_hash": "hash_r62"
      }
    ],
    "query": {
      "focus": "retrieval pipeline token budget",
      "intent": "understand_code",
      "active_files": [],
      "budget": 150,
      "sent_ids": []
    }
  },
  "expected_output": {
    "total_tokens_max": 150,
    "results_min": 1,
    "budget_respected": true,
    "compression_behavior": "Higher-ranked memories get higher compression levels (more detail). Lower-ranked memories get compressed to lower levels or excluded if budget is exhausted."
  }
}
