# DNA Output: Playbook Generator & AI Context Builder

## Location
- `packages/core/src/dna/playbook-generator.ts`
- `packages/core/src/dna/ai-context.ts`

---

## Playbook Generator

### Purpose
Generates a human-readable Markdown playbook from a DNA profile. This is the "style guide" output — what a developer would read to understand the team's conventions.

### Output Structure

```markdown
# Styling Playbook
> Auto-generated by drift DNA analysis. Last updated: {date}

## Quick Reference
| Concern | Our Approach | Confidence |
|---------|--------------|------------|
| Variant Handling | CVA | 85% |
| Responsive | Tailwind breakpoints | 92% |
...

## Health Score: 87/100

---
## Variant Handling
**Our Pattern**: CVA (Class Variance Authority)
{description}
```tsx
{dominant example code}
```
**Exemplar Files**:
- `src/components/Button.tsx`
- `src/components/Card.tsx`
**Avoid**:
- Inline conditionals
- CSS modules

---
## Mutations
Files deviating from established patterns:
- **src/legacy/OldButton.tsx:42** - inline-conditionals (expected: cva-variants)
- ... and 7 more
```

### Key Behaviors
- Shows top 10 mutations (with "and N more" overflow)
- Per-gene sections include: dominant pattern, code example, exemplar files, and "avoid" list of non-dominant alleles
- Genes without a dominant allele show "*No dominant pattern established*"

---

## AI Context Builder

### Purpose
Generates AI-ready context at 4 detail levels for injection into LLM prompts. Token-efficient — pick the level that fits your context window.

### Context Levels

| Level | ~Tokens | Format | Use Case |
|-------|---------|--------|----------|
| 1 | ~20 | One-liner | System prompt injection, minimal overhead |
| 2 | ~200 | Markdown table | Moderate context window, quick reference |
| 3 | ~500–2000 | Full sections with code | Code generation, detailed guidance |
| 4 | Unlimited | Raw JSON | Maximum detail, debugging |

### Level 1 Output
```
tailwind codebase using CVA, Tailwind breakpoints, Data attributes. Health: 87/100.
```

### Level 2 Output
```markdown
## Styling Conventions

| Concern | Approach | Confidence |
|---------|----------|------------|
| Variant Handling | CVA | 85% |
| Responsive | Tailwind breakpoints | 92% |
...

Health Score: 87/100
```

### Level 3 Output
```markdown
# Styling Conventions (tailwind)

## Variant Handling
Use CVA:
```tsx
const button = cva("base", { variants: { size: { sm: "...", lg: "..." } } });
```

## Responsive Approach
Use Tailwind breakpoints:
```tsx
<div className="w-full md:w-1/2 lg:w-1/3">
```

---
⚠️ 3 mutations detected
- src/legacy/OldButton.tsx: inline-conditionals
```

### Level 4 Output
Raw `JSON.stringify(profile, null, 2)` — the complete `StylingDNAProfile`.

### Usage
```typescript
const builder = new AIContextBuilder();
const context = builder.build(profile, 3); // Level 3
// Inject into system prompt or tool response
```

## Rust Rebuild Considerations
- Both are text templating — stay in TypeScript
- Level 4 is just JSON serialization — trivial either way
- The value is in the template logic, not performance
