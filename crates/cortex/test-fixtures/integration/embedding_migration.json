{
  "description": "Model swap mid-operation: create with model A → switch to B → re-embedding → retrieval works during transition (FTS5 fallback)",
  "scenario": {
    "name": "embedding_migration",
    "steps": [
      {
        "step": 1,
        "action": "create_with_model_a",
        "model": { "name": "jina-code-v2", "dimensions": 1024 },
        "memory_count": 20,
        "expected": {
          "all_embeddings_1024_dim": true,
          "retrieval_works": true
        }
      },
      {
        "step": 2,
        "action": "switch_model",
        "new_model": { "name": "jina-code-v3", "dimensions": 768 },
        "expected": {
          "config_updated": true,
          "old_embeddings_still_in_db": true,
          "dimension_mismatch_detected": true
        }
      },
      {
        "step": 3,
        "action": "retrieve_during_transition",
        "query": { "focus": "database configuration", "budget": 2000 },
        "expected": {
          "retrieval_works": true,
          "fallback_to_fts5": true,
          "vector_search_skipped_or_degraded": true,
          "degradation_event_logged": true,
          "degradation_event": {
            "component": "embeddings",
            "failure": "dimension_mismatch",
            "fallback_used": "fts5_only"
          }
        }
      },
      {
        "step": 4,
        "action": "re_embed_all",
        "expected": {
          "all_embeddings_768_dim": true,
          "old_embeddings_replaced": true,
          "cache_invalidated": true,
          "migration_status_tracked": true
        }
      },
      {
        "step": 5,
        "action": "retrieve_after_migration",
        "query": { "focus": "database configuration", "budget": 2000 },
        "expected": {
          "retrieval_works": true,
          "vector_search_operational": true,
          "no_degradation": true
        }
      }
    ]
  },
  "success_criteria": {
    "zero_downtime": true,
    "no_data_loss": true,
    "fts5_fallback_seamless": true,
    "migration_completes": true
  }
}
