{
  "description": "Each component failure + expected fallback behavior — graceful degradation matrix",
  "scenarios": [
    {
      "id": "deg-01",
      "component": "embeddings",
      "failure": "onnx_model_load_failed",
      "trigger": "ONNX model file missing or corrupted",
      "expected_fallback": "fts5_only_retrieval",
      "expected_degradation_event": {
        "component": "embeddings",
        "failure": "ModelLoadFailed",
        "fallback_used": "FTS5-only retrieval (keyword search without vector similarity)"
      },
      "user_impact": "Retrieval works but only via keyword matching — semantic search unavailable"
    },
    {
      "id": "deg-02",
      "component": "embeddings",
      "failure": "inference_timeout",
      "trigger": "Embedding inference exceeds timeout threshold",
      "expected_fallback": "cached_embeddings_or_fts5",
      "expected_degradation_event": {
        "component": "embeddings",
        "failure": "InferenceFailed",
        "fallback_used": "L2 SQLite cache lookup, then FTS5-only if cache miss"
      },
      "user_impact": "Slightly stale embeddings or keyword-only search"
    },
    {
      "id": "deg-03",
      "component": "storage",
      "failure": "sqlite_corruption_detected",
      "trigger": "Integrity check fails on database file",
      "expected_fallback": "backup_restore",
      "expected_degradation_event": {
        "component": "storage",
        "failure": "CorruptionDetected",
        "fallback_used": "Restore from most recent backup, log data loss window"
      },
      "user_impact": "Brief unavailability during restore, potential loss of recent memories"
    },
    {
      "id": "deg-04",
      "component": "consolidation",
      "failure": "hdbscan_clustering_failed",
      "trigger": "HDBSCAN returns error on malformed input",
      "expected_fallback": "skip_consolidation_cycle",
      "expected_degradation_event": {
        "component": "consolidation",
        "failure": "ClusteringFailed",
        "fallback_used": "Skip this consolidation cycle, retry on next schedule"
      },
      "user_impact": "Episodic memories accumulate longer before consolidation"
    },
    {
      "id": "deg-05",
      "component": "causal",
      "failure": "graph_inconsistency",
      "trigger": "Node referenced in edge doesn't exist in graph",
      "expected_fallback": "prune_orphan_edges",
      "expected_degradation_event": {
        "component": "causal",
        "failure": "GraphInconsistency",
        "fallback_used": "Prune orphan edges, rebuild index from storage"
      },
      "user_impact": "Some causal relationships temporarily unavailable"
    },
    {
      "id": "deg-06",
      "component": "validation",
      "failure": "citation_file_not_found",
      "trigger": "Linked file no longer exists on disk",
      "expected_fallback": "mark_citation_stale",
      "expected_degradation_event": {
        "component": "validation",
        "failure": "CitationStale",
        "fallback_used": "Mark citation as stale, reduce confidence, flag for review"
      },
      "user_impact": "Memory still available but with reduced confidence"
    },
    {
      "id": "deg-07",
      "component": "cloud",
      "failure": "network_unreachable",
      "trigger": "Cloud sync endpoint unreachable",
      "expected_fallback": "offline_mode",
      "expected_degradation_event": {
        "component": "cloud",
        "failure": "NetworkError",
        "fallback_used": "Queue changes for later sync, operate in offline mode"
      },
      "user_impact": "All features work locally, sync resumes when network returns"
    },
    {
      "id": "deg-08",
      "component": "privacy",
      "failure": "pattern_regex_compilation_failed",
      "trigger": "Custom regex pattern is invalid",
      "expected_fallback": "skip_invalid_pattern",
      "expected_degradation_event": {
        "component": "privacy",
        "failure": "PatternCompilationFailed",
        "fallback_used": "Skip invalid pattern, use remaining patterns, log warning"
      },
      "user_impact": "Slightly reduced PII detection coverage for the invalid pattern"
    },
    {
      "id": "deg-09",
      "component": "retrieval",
      "failure": "ranking_pipeline_error",
      "trigger": "Re-ranker throws error on malformed candidate",
      "expected_fallback": "return_unranked_candidates",
      "expected_degradation_event": {
        "component": "retrieval",
        "failure": "RankingFailed",
        "fallback_used": "Return candidates in RRF fusion order without re-ranking"
      },
      "user_impact": "Results may be slightly less relevant but still returned"
    },
    {
      "id": "deg-10",
      "component": "decay",
      "failure": "adaptive_factor_computation_error",
      "trigger": "Division by zero in adaptive half-life calculation",
      "expected_fallback": "use_default_half_life",
      "expected_degradation_event": {
        "component": "decay",
        "failure": "AdaptiveComputationFailed",
        "fallback_used": "Fall back to default half-life for the memory type"
      },
      "user_impact": "Decay rate slightly less personalized but still functional"
    }
  ],
  "success_criteria": {
    "all_fallbacks_triggered": true,
    "all_degradation_events_logged": true,
    "no_panics": true,
    "no_data_loss": true,
    "system_remains_operational": true
  }
}
